<!DOCTYPE html>
<html>
<head>
    <title>The Grid</title>
    <link rel="stylesheet" type="text/css" href="/static/main.css">

</head>
<body>
    <div id="main"></div>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script src="/static/grid.js"></script>
    <script src="/static/colors.js"></script>
    <script type="text/javascript">

    var rows = Grid.rows
    ,   cols = Grid.cols
    ,   delay = 100
    ,   grid = Grid.make(cols, rows)
    ,   socket = io()
    ,   black = 'rgb(0, 0, 0)'
    ,   white = 'rgb(255, 255, 255)'
    ,   $main = $('#main')
    ,   id = +window.location.search.match(/(\d+)/)[0]

    function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    $main.on('click', function (ev) {
        socket.emit('toggle', {
            color: window.colors[randomInt(0, window.colors.length)],
            origin: id
        })
    })

    socket.on('toggle', function(message){
        var distance = grid.distance(
            grid.coords(id)[0],
            grid.coords(id)[1]
        )
        _.delay(function () {
            $main.css('background-color', message.color)
        }, distance(message.origin) * delay)
    })

    </script>
</body>
</html>
